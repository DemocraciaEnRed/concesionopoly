<!-- 
<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="gmaps.js"></script>

<div id="mouse_event_map"></div>

<script type="text/javascript">

  map = new GMaps({
    div: '#mouse_event_map',
    zoom: 16,
    lat: -12.043333,
    lng: -77.028333,
    click: function(e) {
      alert('click');
    },
    dragend: function(e) {
      alert('dragend');
    }
  });

  map.addMarker({
    lat: -12.043333,
    lng: -77.028333,
    title: 'Lima',
    click: function(e) {
      alert('You clicked in this marker');
    }
  });
</script>
 -->


<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>gmaps.js &mdash; the easiest way to use Google Maps</title>
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=true"></script>
  <script type="text/javascript" src="gmaps.js"></script>
  <link href='//fonts.googleapis.com/css?family=Convergence|Bitter|Droid+Sans|Ubuntu+Mono' rel='stylesheet' type='text/css' />
  <link href='styles.css' rel='stylesheet' type='text/css' />

  <script type="text/javascript">
  // ["1", "Importe Fijo", "49.029,00", "Decreto N 667/GCBA/2010 A la fecha se sustancia readecuacin del canon.", "BUENOS AIRES DESIGN", "EMPRENDIMIENTO RECOLETA S.A.", "AV. PUEYRREDON 2501", "PREDIOS COMERCIALES", "17/11/2018"]
    TIPO_IMPORTE = 1;
    PRECIO = 2;
    NOMBRE = 4;
    EMPRESA = 5;
    DIRECCION = 6;
    
    var map;
    $(document).ready(function(){
      map = new GMaps({
        div: '#map',
        lat: -12.043333,
        lng: -77.028333
      });
      /*map.addMarker({
        lat: -12.043333,
        lng: -77.03,
        title: 'Lima',
        details: {
          database_id: 42,
          author: 'HPNeo'
        },
        click: function(e){
          if(console.log)
            console.log(e);
          alert('You clicked in this marker');
        }
      });*/

    $.ajax({
      url: "../db/Concesiones%20-%20Consolidado.tsv",
      beforeSend: function( xhr ) {
        xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
      }
    })
      .done(function( data ) {
        var rows = data.split('\n');
        // 1 porque sacamos 
        for ( var i = 1; i<rows.length; i++ ) {
        //for ( var i = 1; i<20; i++ ) {
          tds = rows[i].split('\t');
          if (tds[DIRECCION] != "#N/A" && tds[DIRECCION].indexOf('-') === -1){

            //alert(tds[DIRECCION] + ", Buenos Aires");
            //console.log( "Sample of data:", tds);
            // console.log( "Sample of data:", tds[DIRECCION] + ", Buenos Aires, Argentina");
            GMaps.geocode({
            address: tds[DIRECCION] + ", Buenos Aires, Argentina",
            callback: function(results, status) {
              if (status == 'OK') {
                var latlng = results[0].geometry.location;
                map.setCenter(latlng.lat(), latlng.lng());
                map.addMarker({
                  lat: latlng.lat(),
                  lng: latlng.lng(),
                  title: 'Marker with InfoWindow',
                  infoWindow: {
                    content: '<p>' + tds[EMPRESA] + ' ' + tds[DIRECCION] + '</p>'
                  }

                });

              salida =  "<div>" + tds[DIRECCION] + " <div > </div> </div>";
              $("#list").append($(salida));
              //alert(tds[DIRECCION] + ", Buenos Aires, Argentina");

              } else {
                // $("#list").append($("error"));
                console.log( "ERROR", tds[DIRECCION] + ", Buenos Aires, Argentina");
              }
            }
          });
            
          }

        }
        /*if ( console && console.log ) {
          console.log( "Sample of data:", data.slice( 0, 100 ) );
        }*/
      });


      /*GMaps.geocode({
        address: "Castañon 1334, Buenos Aires",
        callback: function(results, status) {
          if (status == 'OK') {
            var latlng = results[0].geometry.location;
            map.setCenter(latlng.lat(), latlng.lng());
            map.addMarker({
              lat: latlng.lat(),
              lng: latlng.lng(),
              title: 'Marker with InfoWindow',
              infoWindow: {
                        content: '<p>Castañon 1334</p>'
                      }

            });
          }
        }
      });*/

/*      map.addMarker({
        lat: -12.042,
        lng: -77.028333,
        title: 'Marker with InfoWindow',
        infoWindow: {
          content: '<p>HTML Content</p>'
        }
      });*/
    });
  </script>
</head>
<body>

  <div class="row">
    <div class="span11">
      <div class="popin">
        <div id="list">

        </div>
        <div id="map"></div>
      </div>
    </div>
  </div>

</body>
</html>
